{% load static staticfiles %}
<html>
    <head>
        <title>SSH--{{user}}</title>
        <link rel="stylesheet" href="{% static "css/gateone.css" %}">
        <link href="{% static "images/favicon-ssh.ico" %}" rel="shortcut icon" />
    </head>
    <body> 
        <!--<iframe class="page" src='/gateone/?ssh=ssh://{{user}}@inner.cheerl.online/'>
        </iframe>-->
        <div id="gateone_container" style="position: relative; width: 100%; height: 100%; margin: 0 auto;">  
            <div id="gateone"></div>
        </div>
    </body>
    <script src="{% static "js/jquery-3.1.1.min.js" %}"></script>
    <script src="{% static "js/gateone.js" %}"></script>
    <script>
        var ssh_host = '{{user}}@' + window.location.host;
        var ssh_url = 'ssh://' + ssh_host + ':' + 22;
        var server_url = '/gateone/'; //+ '?ssh=' + ssh_url

        function close_all_workspace(){
            var grid = $('#go_default_gridwrapper');
            grid.children().each(function(){
                var num = $(this).attr('data-workspace');
                GateOne.Visual.closeWorkspace(num);
            });
            alert('成功退出, 返回登录界面');
            window.top.location.href = '/ssh/logout/';
        }

        $(document).ready(function(){
            GateOne.init({
                url: server_url,
                //url: link + server_url,
                theme:'black',
                goDiv:'#gateone',
                //embedded: true,
                disableTermTransitions:'true',
                autoConnectURL:ssh_url,
            });

            GateOne.Base.superSandbox(
                "NewExternalTerm",
                ["GateOne.Terminal", "GateOne.Terminal.Input"],
                function(window, undefined) {
                    GateOne.prefs.autoConnectURL=ssh_url;
                    GateOne.prefs.fontSize="100%";
                    //GateOne.prefs.scrollback = 10000; // scrollback buffer up to 10,000 lines-->
                    //GateOne.Terminal.loadFont("Source Code Pro", "150%");
                    GateOne.locations; // Holds the state of all current known/open locations-->
                    GateOne.Net.setLocation(ssh_host);

                    var interval = setInterval(show_info, 200);

                    function show_info(){
                        var info = $('h2.✈appchooser_title');
                        if (info.length){
                            clearInterval(interval);
                            info.text('自动跳转中');
                            info.after($('<h2 class="✈appchooser_title">若长时间无反应请点击下方图标</h2>'));

                            setTimeout(function(){
                                var app = $('div.✈superfasttrans.✈application');
                                if (app.length){
                                    app.click();
                                }
                            }, 5000);

                            var bar = $('#go_default_icon_bookmarks');
                            var logout = $(
                                '<div id="logout_div" class="✈toolbar_icon" title="logout" onclick="close_all_workspace();">'+
                                    '<img id="logout" src="/static/images/exit.png">'+
                                '</div>'
                            );
                            bar.after(logout);
                        }
                    }
                }
            );
        });
    </script>

    <style>
        iframe{
             position: relative;
             width: 100%;
             height: 100%;
             margin: 0;
             border: 0;
        }

        #logout{
            width: 20px;
            height: 20px;
        }
        #logout_div{
            margin-right: 4px;
        }
    </style>
</html> 
