{% extends 'helper/base.html' %}
{% load static staticfiles %}
{% block title %}
    微信小助手-日志
{% endblock %}

{% block content%}
    <div id='main_body'>
        <div id="log_box"></div>
        <a href="/helper/log/all/">
        <div id="button">
            查看全部日志
        </div>
        </a>
    </div>
{% endblock %} {% block script %}
<script>
    var log_box = $('div#log_box');
    var button = $('#button');

    function get_log(start, count) {
        $.get('/helper/log/get/start=' + start + '&count=' + count, function (data) {
            for (i = 0; i < count; i++) {
                log_box.append('<p>' + data.log_list[i] + '</p>');
            }
        });
    }

    function show_message(message) {
        var data = JSON.parse(message.data)
        log_box.prepend('<p>' + data.msg + '</p>');
    }
    $(function () {
        get_log(0, 20);
        var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
        var sock = new WebSocket(ws_scheme + '://' + window.location.host + "/log/"); //+ window.location.pathname);

        sock.onmessage = function (message) {
            show_message(message);
        };

        button.hover(
                function(){
                    var color = $(this).css('border-color');
                    $(this).css('color', 'rgb(255, 255, 255)');
                    $(this).css('background-color', color);
                },
                function () {
                    var color = $(this).css('border-color');
                    $(this).css('background-color', 'rgb(255, 255, 255)');
                    $(this).css('color', color);
                }
            );
    });
</script>
{% endblock %}
{% block style %}
<style>
    div {
        float: left;
    }

    div#main_body {
        width: 100%;
        height: 100%;
    }

    div#log_box {
        position: relative;
        height: 80%;
        width: 85%;
        left: 7.5%;
        top: 7.5%;

        text-align: left;
        color: #f6f9f6;
        font: 16px;
        word-wrap: break-word;
        word-break: break-all;
        overflow-y: visible;
        overflow-x: hidden;

        background-color: rgba(0, 0, 0, .65);
        border: 5px groove black;

        /*圆角*/
        -moz-border-radius: 10px;
        border-radius: 10px;
    }

    p {
        padding: 5px 10px;
        padding-bottom: 0px;
    }

    div#button {
        position: relative;
        text-decoration: none;
        left: 42%;
        width: 16%;
        top: 10%;

        display: inline-block;
        padding: 0 20px;
        text-align: center;
        font: 16px/30px Arial, sans-serif;

        -moz-border-radius: 30px;
        border-radius: 30px;

        -webkit-transition: all 0.15s ease;
        -moz-transition: all 0.15s ease;
        -o-transition: all 0.15s ease;
        -ms-transition: all 0.15s ease;
        transition: all 0.15s ease;
        border: 1px solid rgba(0, 0, 0, 0.8);
    }
</style>
{% endblock %}